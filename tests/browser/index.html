
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Android test suite</title>
    <link rel="stylesheet" href="https://unpkg.com/mocha/mocha.css">

  <body>
    <div id="mocha"></div>
    <script src="https://unpkg.com/mocha/mocha.js"></script>
    <script src="https://unpkg.com/chai@4.5.0/chai.js"></script>
    <script>mocha.setup('bdd')</script>
    <script>expect = chai.expect</script>
    <script>
        window.testUtils = {
            waitForPywebview: () => {
                return new Promise((resolve, reject) => {
                    const checkPywebview = () => {
                        if (window.pywebview && window.pywebview.state !== undefined) {
                            resolve();
                        } else {
                            setTimeout(checkPywebview, 50);
                        }
                    };
                    checkPywebview();

                    // Timeout after 10 seconds
                    setTimeout(() => {
                        reject(new Error('PyWebView not available after 10 seconds'));
                    }, 10000);
                });
            },

            wait: (ms) => new Promise(resolve => setTimeout(resolve, ms)),

            waitForCondition: (condition, timeout = 5000) => {
                return new Promise((resolve, reject) => {
                    const start = Date.now();
                    const check = () => {
                        if (condition()) {
                            resolve();
                        } else if (Date.now() - start > timeout) {
                            reject(new Error('Timeout waiting for condition'));
                        } else {
                            setTimeout(check, 10);
                        }
                    };
                    check();
                });
            },

            resetState: () => {
                if (window.pywebview && window.pywebview.state) {
                    // Get all keys from state and delete them
                    const keys = Object.keys(window.pywebview.state);
                    keys.forEach(key => {
                        delete window.pywebview.state[key];
                    });
                }
            }

        };
    </script>


    <script src="tests/test-js-api.js"></script>
    <script src="tests/test-state.js"></script>


    <script>
      mocha.run();
    </script>
  </body>
</html>
